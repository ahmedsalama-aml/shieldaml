<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShieldAML â€” Fraud Detection System</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#060A14;--surface:#0D1526;--surface2:#111D35;
    --border:rgba(99,179,237,0.12);--accent:#00D4FF;--accent2:#7B61FF;
    --danger:#FF4D6D;--warning:#FFB347;--safe:#00E5A0;
    --text:#E8F0FE;--muted:#6B8BAE;
    --font-display:'Syne',sans-serif;--font-body:'DM Sans',sans-serif;--font-mono:'DM Mono',monospace;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:var(--bg);color:var(--text);font-family:var(--font-body);min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
  .orb{position:fixed;border-radius:50%;filter:blur(80px);pointer-events:none;z-index:0}
  .orb-1{width:400px;height:400px;background:rgba(0,212,255,0.06);top:-100px;right:-100px}
  .orb-2{width:300px;height:300px;background:rgba(123,97,255,0.06);bottom:100px;left:-50px}
  .app{position:relative;z-index:1;display:flex;min-height:100vh}

  /* SIDEBAR */
  .sidebar{width:240px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:24px 0;position:fixed;top:0;left:0;bottom:0;z-index:100}
  .logo{padding:0 24px 28px;border-bottom:1px solid var(--border)}
  .logo-mark{font-family:var(--font-display);font-size:22px;font-weight:800;color:var(--accent)}
  .logo-sub{font-size:10px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-top:2px;font-family:var(--font-mono)}
  .nav{padding:20px 12px;flex:1}
  .nav-label{font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;padding:0 12px;margin-bottom:8px;font-family:var(--font-mono)}
  .nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;cursor:pointer;color:var(--muted);font-size:13px;font-weight:500;transition:all 0.2s;margin-bottom:2px;border:1px solid transparent}
  .nav-item:hover{background:var(--surface2);color:var(--text)}
  .nav-item.active{background:rgba(0,212,255,0.08);color:var(--accent);border-color:rgba(0,212,255,0.2)}
  .sidebar-footer{padding:16px 24px;border-top:1px solid var(--border)}
  .user-badge{display:flex;align-items:center;gap:10px}
  .avatar{width:32px;height:32px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--bg);font-family:var(--font-display)}
  .user-name{font-size:12px;font-weight:600;color:var(--text)}
  .user-role{font-size:10px;color:var(--muted)}
  .api-status{font-size:10px;font-family:var(--font-mono);margin-top:8px;display:flex;align-items:center;gap:5px}
  .status-dot{width:6px;height:6px;border-radius:50%;background:var(--safe);animation:pulse 2s infinite}

  /* MAIN */
  .main{margin-left:240px;flex:1;padding:32px}
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:32px}
  .page-title{font-family:var(--font-display);font-size:26px;font-weight:800}
  .page-sub{font-size:13px;color:var(--muted);margin-top:3px}
  .header-actions{display:flex;gap:10px;align-items:center}
  .btn{padding:9px 18px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:none;font-family:var(--font-body);transition:all 0.2s}
  .btn-ghost{background:var(--surface);color:var(--muted);border:1px solid var(--border)}
  .btn-ghost:hover{color:var(--text);border-color:var(--accent)}
  .btn-primary{background:var(--accent);color:var(--bg)}
  .btn-primary:hover{opacity:0.85;transform:translateY(-1px)}
  .btn-danger{background:var(--danger);color:#fff}

  /* KPI */
  .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:28px}
  .kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;position:relative;overflow:hidden;transition:border-color 0.2s}
  .kpi-card:hover{border-color:rgba(0,212,255,0.3)}
  .kpi-card::after{content:'';position:absolute;top:0;left:0;right:0;height:2px}
  .kpi-card.danger::after{background:var(--danger)}
  .kpi-card.warning::after{background:var(--warning)}
  .kpi-card.safe::after{background:var(--safe)}
  .kpi-card.info::after{background:var(--accent)}
  .kpi-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;font-family:var(--font-mono)}
  .kpi-value{font-family:var(--font-display);font-size:32px;font-weight:800;margin:8px 0 4px}
  .kpi-value.danger{color:var(--danger)}
  .kpi-value.warning{color:var(--warning)}
  .kpi-value.safe{color:var(--safe)}
  .kpi-value.info{color:var(--accent)}
  .kpi-change{font-size:12px;color:var(--muted)}
  .kpi-icon{position:absolute;top:16px;right:16px;font-size:24px;opacity:0.3}

  /* LAYOUT */
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
  .grid-3-2{display:grid;grid-template-columns:1.4fr 1fr;gap:20px;margin-bottom:20px}

  /* PANELS */
  .panel{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:20px}
  .panel-header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
  .panel-title{font-family:var(--font-display);font-size:14px;font-weight:700}
  .panel-badge{font-size:10px;padding:3px 8px;border-radius:20px;font-family:var(--font-mono);font-weight:500}
  .badge-danger{background:rgba(255,77,109,0.15);color:var(--danger);border:1px solid rgba(255,77,109,0.3)}
  .badge-warning{background:rgba(255,179,71,0.15);color:var(--warning);border:1px solid rgba(255,179,71,0.3)}
  .badge-safe{background:rgba(0,229,160,0.15);color:var(--safe);border:1px solid rgba(0,229,160,0.3)}
  .badge-info{background:rgba(0,212,255,0.15);color:var(--accent);border:1px solid rgba(0,212,255,0.3)}

  /* TABLE */
  .table-wrap{overflow-x:auto}
  table{width:100%;border-collapse:collapse}
  th{padding:10px 16px;text-align:left;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;font-family:var(--font-mono);border-bottom:1px solid var(--border);background:rgba(0,0,0,0.2)}
  td{padding:13px 16px;font-size:13px;border-bottom:1px solid var(--border);color:var(--text)}
  tr:last-child td{border-bottom:none}
  tr:hover td{background:rgba(255,255,255,0.02)}
  .risk-pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;font-family:var(--font-mono)}
  .risk-pill.CRITICAL,.risk-pill.HIGH{background:rgba(255,77,109,0.15);color:var(--danger);border:1px solid rgba(255,77,109,0.3)}
  .risk-pill.MEDIUM{background:rgba(255,179,71,0.15);color:var(--warning);border:1px solid rgba(255,179,71,0.3)}
  .risk-pill.LOW{background:rgba(0,229,160,0.15);color:var(--safe);border:1px solid rgba(0,229,160,0.3)}
  .risk-dot{width:6px;height:6px;border-radius:50%}
  .risk-dot.HIGH,.risk-dot.CRITICAL{background:var(--danger);box-shadow:0 0 6px var(--danger)}
  .risk-dot.MEDIUM{background:var(--warning)}
  .risk-dot.LOW{background:var(--safe)}
  .score-bar-wrap{display:flex;align-items:center;gap:10px}
  .score-bar{flex:1;height:4px;background:var(--surface2);border-radius:2px;overflow:hidden}
  .score-bar-fill{height:100%;border-radius:2px}
  .score-num{font-size:12px;font-family:var(--font-mono);min-width:30px;text-align:right}

  /* FORM */
  .scanner-form{padding:20px}
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
  .form-group{display:flex;flex-direction:column;gap:6px}
  .form-group.full{grid-column:1/-1}
  label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;font-family:var(--font-mono)}
  input,select{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 12px;color:var(--text);font-size:13px;font-family:var(--font-body);outline:none;transition:border-color 0.2s}
  input:focus,select:focus{border-color:var(--accent)}
  select option{background:var(--bg)}

  /* RESULT */
  .result-card{margin:0 20px 20px;border-radius:10px;padding:20px;display:none;animation:fadeSlideIn 0.4s ease}
  .result-card.show{display:block}
  .result-card.CRITICAL,.result-card.HIGH{background:rgba(255,77,109,0.08);border:1px solid rgba(255,77,109,0.3)}
  .result-card.MEDIUM{background:rgba(255,179,71,0.08);border:1px solid rgba(255,179,71,0.3)}
  .result-card.LOW{background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.3)}
  .result-score-big{font-family:var(--font-display);font-size:40px;font-weight:800;line-height:1}
  .result-score-big.CRITICAL,.result-score-big.HIGH{color:var(--danger)}
  .result-score-big.MEDIUM{color:var(--warning)}
  .result-score-big.LOW{color:var(--safe)}
  .flag-item{display:flex;align-items:flex-start;gap:8px;font-size:12px;padding:8px 10px;background:rgba(0,0,0,0.2);border-radius:6px;margin-bottom:6px}

  /* ALERTS */
  .alert-item{display:flex;align-items:center;gap:12px;padding:12px 20px;border-bottom:1px solid var(--border);cursor:pointer;transition:background 0.15s}
  .alert-item:hover{background:rgba(255,255,255,0.02)}
  .alert-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
  .alert-dot.CRITICAL,.alert-dot.HIGH{background:var(--danger);box-shadow:0 0 8px var(--danger);animation:pulse 2s infinite}
  .alert-dot.MEDIUM{background:var(--warning)}
  .alert-dot.LOW{background:var(--safe)}
  .alert-content{flex:1}
  .alert-title{font-size:13px;font-weight:500}
  .alert-meta{font-size:11px;color:var(--muted);margin-top:2px;font-family:var(--font-mono)}
  .alert-time{font-size:10px;color:var(--muted);font-family:var(--font-mono)}

  /* BAR CHART */
  .chart-wrap{padding:20px}
  .bar-chart{display:flex;flex-direction:column;gap:10px}
  .bar-row{display:flex;align-items:center;gap:10px}
  .bar-label{font-size:11px;color:var(--muted);width:100px;font-family:var(--font-mono);text-align:right}
  .bar-track{flex:1;height:8px;background:var(--surface2);border-radius:4px;overflow:hidden}
  .bar-fill{height:100%;border-radius:4px;transition:width 1s ease}
  .bar-val{font-size:11px;font-family:var(--font-mono);color:var(--muted);width:35px}

  /* STR MODAL */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(4px);z-index:999;display:none;align-items:center;justify-content:center}
  .modal-overlay.show{display:flex}
  .modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:600px;max-height:80vh;overflow-y:auto;animation:fadeSlideIn 0.3s ease}
  .modal-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--surface)}
  .modal-title{font-family:var(--font-display);font-size:16px;font-weight:800}
  .modal-close{cursor:pointer;background:none;border:none;color:var(--muted);font-size:20px}
  .modal-body{padding:24px}
  .str-field{margin-bottom:16px}
  .str-field-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;font-family:var(--font-mono);margin-bottom:6px}
  .str-field-value{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:12px;font-size:13px;line-height:1.6;color:var(--text);white-space:pre-wrap}
  .str-field-value.highlight{border-color:rgba(255,77,109,0.4);background:rgba(255,77,109,0.05)}
  .modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end}

  /* LOADING */
  .loading{display:inline-block;width:16px;height:16px;border:2px solid rgba(0,212,255,0.3);border-top-color:var(--accent);border-radius:50%;animation:spin 0.7s linear infinite}

  @keyframes fadeSlideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
  @keyframes spin{to{transform:rotate(360deg)}}
  ::-webkit-scrollbar{width:4px}
  ::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-mark">ğŸ›¡ ShieldAML</div>
      <div class="logo-sub">Fraud Detection v1.0</div>
    </div>
    <nav class="nav">
      <div class="nav-label">Main</div>
      <div class="nav-item active" onclick="showPage('dashboard')"><span>ğŸ“Š</span> Dashboard</div>
      <div class="nav-item" onclick="showPage('scanner')"><span>ğŸ”</span> Transaction Scanner</div>
      <div class="nav-item" onclick="showPage('alerts')"><span>ğŸš¨</span> Live Alerts <span class="panel-badge badge-danger" style="margin-left:auto" id="alert-badge">...</span></div>
      <div class="nav-item" onclick="showPage('network')"><span>ğŸ•¸</span> Network Map</div>
      <br>
      <div class="nav-label">Reports</div>
      <div class="nav-item" onclick="showPage('str')"><span>ğŸ“„</span> STR Reports</div>
      <div class="nav-item" onclick="showPage('kyc')"><span>ğŸ‘¤</span> KYC Checker</div>
    </nav>
    <div class="sidebar-footer">
      <div class="user-badge">
        <div class="avatar">AS</div>
        <div>
          <div class="user-name">Ahmed Salama</div>
          <div class="user-role">AML Supervisor Â· CAMS</div>
        </div>
      </div>
      <div class="api-status"><span class="status-dot"></span><span id="api-status-text" style="color:var(--safe)">API Connected</span></div>
    </div>
  </aside>

  <main class="main">

    <!-- DASHBOARD -->
    <div id="page-dashboard">
      <div class="header">
        <div><div class="page-title">Fraud Intelligence Dashboard</div><div class="page-sub">Real-time AML monitoring</div></div>
        <div class="header-actions">
          <button class="btn btn-ghost" onclick="loadDashboard()">â†» Refresh</button>
          <button class="btn btn-primary" onclick="showPage('scanner')">+ Scan Transaction</button>
        </div>
      </div>
      <div class="kpi-grid">
        <div class="kpi-card danger"><div class="kpi-icon">ğŸš¨</div><div class="kpi-label">High Risk Alerts</div><div class="kpi-value danger" id="kpi-high">â€”</div><div class="kpi-change">Requires immediate action</div></div>
        <div class="kpi-card warning"><div class="kpi-icon">âš ï¸</div><div class="kpi-label">Under Review</div><div class="kpi-value warning" id="kpi-medium">â€”</div><div class="kpi-change">Enhanced monitoring active</div></div>
        <div class="kpi-card safe"><div class="kpi-icon">âœ…</div><div class="kpi-label">Cleared</div><div class="kpi-value safe" id="kpi-cleared">â€”</div><div class="kpi-change">Low risk transactions</div></div>
        <div class="kpi-card info"><div class="kpi-icon">ğŸ’°</div><div class="kpi-label">Flagged Amount</div><div class="kpi-value info" id="kpi-amount">â€”</div><div class="kpi-change">Total value flagged</div></div>
      </div>
      <div class="grid-3-2">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">Recent Flagged Transactions</div><span class="panel-badge badge-danger">LIVE</span></div>
          <div class="table-wrap"><table><thead><tr><th>ID</th><th>Customer</th><th>Amount</th><th>Type</th><th>Score</th><th>Risk</th></tr></thead><tbody id="tx-tbody"><tr><td colspan="6" style="text-align:center;color:var(--muted);padding:30px">Loading...</td></tr></tbody></table></div>
        </div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">Fraud Type Breakdown</div></div>
          <div class="chart-wrap">
            <div class="bar-chart">
              <div class="bar-row"><div class="bar-label">Wire Fraud</div><div class="bar-track"><div class="bar-fill" style="width:38%;background:#FF4D6D"></div></div><div class="bar-val">38%</div></div>
              <div class="bar-row"><div class="bar-label">Structuring</div><div class="bar-track"><div class="bar-fill" style="width:24%;background:#FFB347"></div></div><div class="bar-val">24%</div></div>
              <div class="bar-row"><div class="bar-label">KYC Fraud</div><div class="bar-track"><div class="bar-fill" style="width:18%;background:#7B61FF"></div></div><div class="bar-val">18%</div></div>
              <div class="bar-row"><div class="bar-label">Crypto ML</div><div class="bar-track"><div class="bar-fill" style="width:12%;background:#00D4FF"></div></div><div class="bar-val">12%</div></div>
              <div class="bar-row"><div class="bar-label">Insurance</div><div class="bar-track"><div class="bar-fill" style="width:8%;background:#00E5A0"></div></div><div class="bar-val">8%</div></div>
            </div>
          </div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">Live Alert Feed</div><span class="panel-badge badge-danger" id="open-alert-badge">...</span></div>
        <div id="alert-feed"><div style="padding:20px;color:var(--muted);text-align:center">Loading...</div></div>
      </div>
    </div>

    <!-- SCANNER -->
    <div id="page-scanner" style="display:none">
      <div class="header">
        <div><div class="page-title">Transaction Scanner</div><div class="page-sub">AI-powered fraud risk assessment â€” Random Forest + Isolation Forest</div></div>
      </div>
      <div class="grid-2" style="align-items:start">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">Transaction Details</div><span class="panel-badge badge-info">ML MODEL ACTIVE</span></div>
          <div class="scanner-form">
            <div class="form-grid">
              <div class="form-group"><label>Customer ID</label><input id="f-cid" value="CUS-00482" placeholder="CUS-00482"></div>
              <div class="form-group"><label>Customer Name</label><input id="f-name" value="Mohammed Al-Rashid" placeholder="Full name"></div>
              <div class="form-group"><label>Amount (USD)</label><input type="number" id="f-amount" value="48500"></div>
              <div class="form-group"><label>Transaction Type</label>
                <select id="f-type">
                  <option value="wire">International Wire Transfer</option>
                  <option value="cash">Cash Deposit</option>
                  <option value="insurance">Insurance Claim</option>
                  <option value="crypto">Crypto Exchange</option>
                  <option value="internal">Internal Transfer</option>
                </select>
              </div>
              <div class="form-group"><label>Destination Country (ISO)</label>
                <select id="f-country">
                  <option value="ae">UAE</option><option value="sa">Saudi Arabia</option>
                  <option value="eg">Egypt</option><option value="us">USA</option>
                  <option value="ir" selected>Iran</option><option value="kp">North Korea</option>
                  <option value="ru">Russia</option><option value="uk">United Kingdom</option>
                  <option value="tr">Turkey</option><option value="pk">Pakistan</option>
                </select>
              </div>
              <div class="form-group"><label>Transaction Hour (0â€“23)</label><input type="number" id="f-hour" value="3" min="0" max="23"></div>
              <div class="form-group"><label>Transactions (Last 30 Days)</label><input type="number" id="f-txcount" value="23"></div>
              <div class="form-group"><label>Account Age (months)</label><input type="number" id="f-age" value="2"></div>
              <div class="form-group"><label>KYC Status</label>
                <select id="f-kyc"><option value="0">Incomplete / Pending</option><option value="1">Verified</option><option value="2">Enhanced Due Diligence</option></select>
              </div>
              <div class="form-group"><label>Previously Flagged?</label>
                <select id="f-flagged"><option value="false">No</option><option value="true">Yes</option></select>
              </div>
              <div class="form-group"><label>Is PEP?</label>
                <select id="f-pep"><option value="false">No</option><option value="true">Yes â€” Politically Exposed Person</option></select>
              </div>
            </div>
            <button class="btn btn-primary" style="width:100%;padding:12px" onclick="runScan()" id="scan-btn">ğŸ” Run Fraud Analysis</button>
          </div>
        </div>
        <div>
          <div class="panel">
            <div class="panel-header"><div class="panel-title">Risk Assessment Result</div></div>
            <div class="result-card" id="result-card">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
                <div class="result-score-big" id="result-score"></div>
                <div><div style="font-family:var(--font-display);font-size:16px;font-weight:700" id="result-title"></div><div style="font-size:12px;color:var(--muted);margin-top:2px" id="result-sub"></div></div>
              </div>
              <div style="font-size:11px;color:var(--muted);margin-bottom:8px;font-family:var(--font-mono);text-transform:uppercase;letter-spacing:1px">FATF Risk Factors Detected</div>
              <div id="flags-list"></div>
              <div style="margin-top:14px">
                <div style="font-size:11px;color:var(--muted);margin-bottom:8px;font-family:var(--font-mono);text-transform:uppercase;letter-spacing:1px">Model Tree Scores</div>
                <div id="factor-bars"></div>
              </div>
            </div>
            <div style="padding:30px;color:var(--muted);font-size:13px;text-align:center" id="result-placeholder">Fill in transaction details and click Run Fraud Analysis</div>
          </div>
          <button class="btn btn-danger" style="width:100%;padding:12px;margin-top:0;display:none;border-radius:0 0 12px 12px" id="str-btn" onclick="generateSTR()">ğŸ“„ Generate STR Report</button>
        </div>
      </div>
    </div>

    <!-- ALERTS -->
    <div id="page-alerts" style="display:none">
      <div class="header"><div><div class="page-title">Live Alerts</div><div class="page-sub">All active fraud alerts requiring review</div></div></div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">Active Alerts</div><span class="panel-badge badge-danger" id="alerts-count-badge">Loading...</span></div>
        <div class="table-wrap">
          <table><thead><tr><th>Alert ID</th><th>Type</th><th>Customer</th><th>Amount</th><th>Description</th><th>Risk</th><th>Status</th><th>Action</th></tr></thead>
          <tbody id="alerts-table-body"><tr><td colspan="8" style="text-align:center;color:var(--muted);padding:30px">Loading...</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- NETWORK MAP -->
    <div id="page-network" style="display:none">
      <div class="header"><div><div class="page-title">Money Laundering Network Map</div><div class="page-sub">Graph analysis â€” suspicious transaction networks & layering detection</div></div></div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">Suspicious Transaction Network</div><span class="panel-badge badge-warning">3 CLUSTERS DETECTED</span></div>
        <div style="padding:20px">
          <canvas id="network-canvas" width="880" height="420" style="border-radius:8px;background:var(--bg);width:100%"></canvas>
          <div style="display:flex;gap:20px;margin-top:12px;font-size:12px;color:var(--muted)">
            <span>ğŸ”´ High Risk Node</span><span>ğŸŸ¡ Medium Risk</span><span>ğŸŸ¢ Clean</span><span>â€” Transaction Link</span>
          </div>
        </div>
      </div>
    </div>

    <!-- STR REPORTS -->
    <div id="page-str" style="display:none">
      <div class="header"><div><div class="page-title">STR Reports</div><div class="page-sub">Suspicious Transaction Reports â€” FRA 161/2024 compliant</div></div></div>
      <div class="panel">
        <div class="panel-header"><div class="panel-title">Generated STR Reports</div><span class="panel-badge badge-info">FRA COMPLIANT</span></div>
        <div class="table-wrap">
          <table><thead><tr><th>Report ID</th><th>Customer</th><th>Amount</th><th>Risk Score</th><th>Status</th><th>Created</th><th>Action</th></tr></thead>
          <tbody id="str-table-body"><tr><td colspan="7" style="text-align:center;color:var(--muted);padding:30px">Loading...</td></tr></tbody></table>
        </div>
      </div>
    </div>

    <!-- KYC -->
    <div id="page-kyc" style="display:none">
      <div class="header"><div><div class="page-title">KYC Identity Checker</div><div class="page-sub">Screen customers against sanctions lists, PEP databases & risk indicators</div></div></div>
      <div class="grid-2" style="align-items:start">
        <div class="panel">
          <div class="panel-header"><div class="panel-title">Customer Lookup</div></div>
          <div class="scanner-form">
            <div class="form-grid">
              <div class="form-group full"><label>Full Name</label><input id="kyc-name" placeholder="Enter full name"></div>
              <div class="form-group"><label>Nationality</label>
                <select id="kyc-nat"><option>Egyptian</option><option>Saudi</option><option>Emirati</option><option>Iranian</option><option>Russian</option><option>American</option><option>British</option><option>Pakistani</option></select>
              </div>
              <div class="form-group"><label>Date of Birth</label><input id="kyc-dob" placeholder="DD/MM/YYYY"></div>
              <div class="form-group"><label>ID / Passport Number</label><input id="kyc-id" placeholder="ID number"></div>
              <div class="form-group"><label>Occupation</label><input id="kyc-occ" placeholder="e.g. Business Owner"></div>
            </div>
            <button class="btn btn-primary" style="width:100%;padding:12px" onclick="runKYC()">ğŸ” Screen Customer</button>
          </div>
        </div>
        <div class="panel">
          <div class="panel-header"><div class="panel-title">Screening Result</div></div>
          <div style="padding:20px" id="kyc-result"><div style="color:var(--muted);text-align:center;padding:40px 0">Enter customer details and click Screen Customer</div></div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- STR MODAL -->
<div class="modal-overlay" id="str-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">ğŸ“„ Suspicious Transaction Report (STR)</div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="str-modal-body"></div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Close</button>
      <button class="btn btn-primary" onclick="window.print()">ğŸ“¥ Print / Save PDF</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// When deployed on Render.com, this will automatically use the live URL
const API = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
  ? 'http://localhost:8000'
  : window.location.origin;

let lastAnalysis = null;
let lastTxData   = null;
let lastTxId     = null;

// â”€â”€â”€ API CALLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function apiFetch(path, opts={}) {
  try {
    const res  = await fetch(API + path, opts);
    const data = await res.json();
    return data;
  } catch(e) {
    console.error('API Error:', e);
    return null;
  }
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  const stats = await apiFetch('/api/dashboard');
  if (stats) {
    document.getElementById('kpi-high').textContent    = stats.high_risk;
    document.getElementById('kpi-medium').textContent  = stats.medium_risk;
    document.getElementById('kpi-cleared').textContent = stats.cleared;
    document.getElementById('kpi-amount').textContent  = '$' + (stats.flagged_amount/1000).toFixed(0) + 'K';
    document.getElementById('open-alert-badge').textContent = stats.open_alerts + ' OPEN';
    document.getElementById('alert-badge').textContent = stats.open_alerts;
  }

  const txRes = await apiFetch('/api/transactions/?limit=6');
  if (txRes?.transactions) {
    const tbody = document.getElementById('tx-tbody');
    tbody.innerHTML = txRes.transactions.map(t => `
      <tr>
        <td><span style="font-family:var(--font-mono);font-size:12px;color:var(--accent)">${t.id}</span></td>
        <td>${t.customer_name}</td>
        <td style="font-family:var(--font-mono)">$${Number(t.amount).toLocaleString()}</td>
        <td><span style="color:var(--muted);font-size:12px">${t.tx_type}</span></td>
        <td>
          <div class="score-bar-wrap">
            <div class="score-bar"><div class="score-bar-fill" style="width:${t.risk_score}%;background:${t.risk_level==='LOW'?'var(--safe)':t.risk_level==='MEDIUM'?'var(--warning)':'var(--danger)'}"></div></div>
            <span class="score-num" style="color:${t.risk_level==='LOW'?'var(--safe)':t.risk_level==='MEDIUM'?'var(--warning)':'var(--danger)'}">${t.risk_score}</span>
          </div>
        </td>
        <td><span class="risk-pill ${t.risk_level}"><span class="risk-dot ${t.risk_level}"></span>${t.risk_level}</span></td>
      </tr>
    `).join('');
  }

  await loadAlertFeed();
}

async function loadAlertFeed() {
  const res = await apiFetch('/api/alerts/?status=OPEN&limit=5');
  const feed = document.getElementById('alert-feed');
  if (res?.alerts?.length) {
    feed.innerHTML = res.alerts.map(a => `
      <div class="alert-item">
        <div class="alert-dot ${a.risk_level}"></div>
        <div class="alert-content">
          <div class="alert-title">${a.alert_type} â€” ${a.customer_name}</div>
          <div class="alert-meta">${a.description} Â· $${Number(a.amount).toLocaleString()}</div>
        </div>
        <div class="alert-time">${new Date(a.created_at).toLocaleTimeString()}</div>
      </div>
    `).join('');
  } else {
    feed.innerHTML = '<div style="padding:20px;color:var(--muted);text-align:center">No open alerts</div>';
  }
}

// â”€â”€â”€ ALERTS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAlertsPage() {
  const res = await apiFetch('/api/alerts/?limit=50');
  const tbody = document.getElementById('alerts-table-body');
  const badge = document.getElementById('alerts-count-badge');
  if (res?.alerts) {
    badge.textContent = res.alerts.filter(a=>a.status==='OPEN').length + ' OPEN';
    tbody.innerHTML = res.alerts.map(a => `
      <tr>
        <td><span style="font-family:var(--font-mono);font-size:12px;color:var(--accent)">${a.id}</span></td>
        <td>${a.alert_type}</td>
        <td>${a.customer_name}</td>
        <td style="font-family:var(--font-mono)">$${Number(a.amount).toLocaleString()}</td>
        <td style="font-size:12px;color:var(--muted)">${a.description}</td>
        <td><span class="risk-pill ${a.risk_level}"><span class="risk-dot ${a.risk_level}"></span>${a.risk_level}</span></td>
        <td><span class="panel-badge ${a.status==='OPEN'?'badge-danger':'badge-safe'}">${a.status}</span></td>
        <td>
          ${a.status==='OPEN'?`<button class="btn btn-ghost" style="padding:4px 10px;font-size:11px" onclick="resolveAlert('${a.id}')">Resolve</button>`:'â€”'}
        </td>
      </tr>
    `).join('');
  }
}

async function resolveAlert(alertId) {
  await apiFetch(`/api/alerts/${alertId}/resolve`, {method:'PATCH'});
  loadAlertsPage();
  loadDashboard();
}

// â”€â”€â”€ STR REPORTS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSTRPage() {
  const res = await apiFetch('/api/str/?limit=50');
  const tbody = document.getElementById('str-table-body');
  if (res?.reports) {
    tbody.innerHTML = res.reports.map(r => `
      <tr>
        <td><span style="font-family:var(--font-mono);font-size:12px;color:var(--accent)">${r.id}</span></td>
        <td>${r.customer_name}</td>
        <td style="font-family:var(--font-mono)">$${Number(r.amount).toLocaleString()}</td>
        <td><span style="font-family:var(--font-mono)">${r.risk_score}/100</span></td>
        <td><span class="panel-badge ${r.status==='SUBMITTED'?'badge-safe':'badge-warning'}">${r.status}</span></td>
        <td style="font-size:12px;color:var(--muted)">${new Date(r.created_at).toLocaleDateString()}</td>
        <td>
          ${r.status==='DRAFT'?`<button class="btn btn-ghost" style="padding:4px 10px;font-size:11px" onclick="submitSTR('${r.id}')">Submit to EIFIU</button>`:'Submitted âœ“'}
        </td>
      </tr>
    `).join('');
  }
}

async function submitSTR(strId) {
  await apiFetch(`/api/str/${strId}/submit`, {method:'PATCH'});
  loadSTRPage();
}

// â”€â”€â”€ TRANSACTION SCANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runScan() {
  const btn = document.getElementById('scan-btn');
  btn.innerHTML = '<span class="loading"></span> Analyzing...';
  btn.disabled = true;

  const txData = {
    customer_id:         document.getElementById('f-cid').value,
    customer_name:       document.getElementById('f-name').value,
    amount:              parseFloat(document.getElementById('f-amount').value)||0,
    type:                document.getElementById('f-type').value,
    country:             document.getElementById('f-country').value,
    hour:                parseInt(document.getElementById('f-hour').value)||12,
    tx_count_30d:        parseInt(document.getElementById('f-txcount').value)||0,
    account_age_months:  parseInt(document.getElementById('f-age').value)||12,
    kyc_status:          parseInt(document.getElementById('f-kyc').value),
    previously_flagged:  document.getElementById('f-flagged').value === 'true',
    is_pep:              document.getElementById('f-pep').value === 'true',
  };

  const res = await apiFetch('/api/transactions/analyze', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(txData),
  });

  btn.innerHTML = 'ğŸ” Run Fraud Analysis';
  btn.disabled  = false;

  if (!res?.analysis) {
    alert('API error â€” make sure backend is running');
    return;
  }

  const a   = res.analysis;
  lastAnalysis = a;
  lastTxData   = txData;
  lastTxId     = res.transaction_id;

  const card = document.getElementById('result-card');
  card.className = `result-card show ${a.risk_level}`;

  document.getElementById('result-score').textContent = a.score;
  document.getElementById('result-score').className   = `result-score-big ${a.risk_level}`;

  const labels = {CRITICAL:'ğŸš¨ CRITICAL RISK',HIGH:'ğŸš¨ HIGH RISK',MEDIUM:'âš ï¸ MEDIUM RISK',LOW:'âœ… LOW RISK'};
  const subs   = {
    CRITICAL: 'Freeze immediately. STR required within 24h.',
    HIGH:     'Escalate to MLRO. Consider filing STR.',
    MEDIUM:   'Enhanced due diligence recommended.',
    LOW:      'Transaction appears legitimate.',
  };
  document.getElementById('result-title').textContent = labels[a.risk_level];
  document.getElementById('result-sub').textContent   = subs[a.risk_level];
  document.getElementById('result-placeholder').style.display = 'none';

  document.getElementById('flags-list').innerHTML = a.flags.map(f =>
    `<div class="flag-item">
      <span style="color:${f.severity==='CRITICAL'?'var(--danger)':f.severity==='HIGH'?'var(--warning)':'var(--muted)'}">â—</span>
      <div><div style="font-size:12px">${f.description}</div><div style="font-size:10px;color:var(--muted);font-family:var(--font-mono);margin-top:2px">${f.fatf_ref}</div></div>
    </div>`
  ).join('');

  document.getElementById('factor-bars').innerHTML = Object.entries(a.tree_scores).map(([name,score]) => `
    <div style="margin-bottom:8px">
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--muted);margin-bottom:3px;font-family:var(--font-mono)">
        <span>${name}</span><span>${score}</span>
      </div>
      <div class="score-bar"><div class="score-bar-fill" style="width:${score}%;background:${score>=60?'var(--danger)':score>=30?'var(--warning)':'var(--safe)'}"></div></div>
    </div>
  `).join('');

  const strBtn = document.getElementById('str-btn');
  strBtn.style.display = a.risk_level !== 'LOW' ? 'block' : 'none';
}

// â”€â”€â”€ STR GENERATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateSTR() {
  if (!lastTxId) return;
  const res = await apiFetch('/api/str/generate', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({transaction_id: lastTxId}),
  });

  const a   = lastAnalysis;
  const now = new Date().toLocaleDateString('en-GB');
  document.getElementById('str-modal-body').innerHTML = `
    <div style="background:rgba(255,77,109,0.08);border:1px solid rgba(255,77,109,0.3);border-radius:8px;padding:12px;margin-bottom:20px;font-size:12px;color:var(--danger)">
      âš ï¸ FRA Law 161/2024 â€” Submit to EIFIU within 24 hours of detection. Do NOT tip off the subject.
    </div>
    ${res?.str_id ? `<div class="str-field"><div class="str-field-label">Report ID</div><div class="str-field-value">${res.str_id} Â· Generated ${now}</div></div>` : ''}
    <div class="str-field"><div class="str-field-label">Reporting Institution</div><div class="str-field-value">ShieldAML System Â· Compliance Officer: Ahmed Salama (CAMS) Â· AML & CFT Supervisor</div></div>
    <div class="str-field"><div class="str-field-label">Subject</div><div class="str-field-value highlight">${lastTxData.customer_name} Â· ID: ${lastTxData.customer_id}</div></div>
    <div class="str-field"><div class="str-field-label">Transaction</div><div class="str-field-value highlight">$${Number(lastTxData.amount).toLocaleString()} USD Â· ${lastTxData.type} Â· ${lastTxData.country.toUpperCase()} Â· Hour: ${lastTxData.hour}:00</div></div>
    <div class="str-field"><div class="str-field-label">AI Risk Score</div><div class="str-field-value highlight">${a.score}/100 â€” ${a.risk_level} RISK (Random Forest Ensemble, 5 decision trees)</div></div>
    <div class="str-field"><div class="str-field-label">FATF Red Flags</div><div class="str-field-value highlight">${a.flags.map(f=>f.description+' ['+f.fatf_ref+']').join('\n')}</div></div>
    <div class="str-field"><div class="str-field-label">Recommended Action</div><div class="str-field-value">${a.recommendation.steps?.join('\n') || 'Review required'}</div></div>
    <div class="str-field"><div class="str-field-label">Compliance Reference</div><div class="str-field-value">FATF Recommendations 2023 Â· FRA Law 161/2024 Â· UN Security Council Sanctions List</div></div>
    <div class="str-field"><div class="str-field-label">Signed By</div><div class="str-field-value">Ahmed Salama Â· CAMS Certified Â· AML & CFT Supervisor Â· ${now}</div></div>
  `;
  document.getElementById('str-modal').classList.add('show');
  if (res?.str_id) loadSTRPage();
}

function closeModal() { document.getElementById('str-modal').classList.remove('show'); }

// â”€â”€â”€ KYC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runKYC() {
  const data = {
    name:        document.getElementById('kyc-name').value,
    nationality: document.getElementById('kyc-nat').value,
    occupation:  document.getElementById('kyc-occ').value,
    country:     '',
  };
  if (!data.name) return;

  const res = await apiFetch('/api/kyc/check', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(data),
  });

  const r   = res?.result;
  if (!r) return;
  const col = r.risk_level==='LOW'?'var(--safe)':r.risk_level==='MEDIUM'?'var(--warning)':'var(--danger)';
  document.getElementById('kyc-result').innerHTML = `
    <div style="display:flex;align-items:center;gap:12px;padding:16px;background:rgba(0,0,0,0.2);border-radius:8px;margin-bottom:12px">
      <div style="width:48px;height:48px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--bg);font-family:var(--font-display)">${data.name.charAt(0).toUpperCase()}</div>
      <div style="flex:1"><div style="font-size:15px;font-weight:700;font-family:var(--font-display)">${r.customer_name}</div><div style="font-size:12px;color:var(--muted)">${data.nationality}</div></div>
      <span class="risk-pill ${r.risk_level}" style="font-size:13px">${r.risk_level}</span>
    </div>
    <div class="flag-item" style="margin-bottom:8px"><span style="color:${r.sanctions_match?'var(--danger)':'var(--safe)'}">â—</span><span>${r.sanctions_match?'âš ï¸ Possible sanctions list match â€” manual verification required':'âœ… No sanctions match detected'}</span></div>
    <div class="flag-item" style="margin-bottom:8px"><span style="color:${r.is_pep?'var(--warning)':'var(--safe)'}">â—</span><span>${r.is_pep?'ğŸ›ï¸ PEP detected â€” Enhanced Due Diligence required (FATF Rec. 12)':'âœ… No PEP indicators found'}</span></div>
    <div class="flag-item" style="margin-bottom:8px"><span style="color:${r.high_risk_nationality?'var(--warning)':'var(--safe)'}">â—</span><span>${r.high_risk_nationality?'âš ï¸ High-risk nationality â€” additional verification required':'âœ… Standard risk nationality'}</span></div>
    <div class="flag-item"><span style="color:var(--accent)">â—</span><span>ğŸ“‹ Required CDD Level: <strong>${r.cdd_level}</strong></span></div>
    ${r.str_required?'<div style="margin-top:12px;padding:10px;background:rgba(255,77,109,0.1);border-radius:8px;font-size:12px;color:var(--danger)">âš ï¸ STR filing may be required. Escalate to MLRO immediately.</div>':''}
  `;
}

// â”€â”€â”€ NETWORK MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawNetwork() {
  const canvas = document.getElementById('network-canvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const nodes = [
    {x:440,y:210,r:22,color:'#FF4D6D',label:'TXN-8821'},{x:200,y:100,r:16,color:'#FF4D6D',label:'CUS-001'},
    {x:680,y:120,r:14,color:'#FFB347',label:'CUS-002'},{x:160,y:300,r:18,color:'#FF4D6D',label:'SHELL CO'},
    {x:700,y:300,r:14,color:'#FFB347',label:'BROKER'},{x:320,y:340,r:12,color:'#00E5A0',label:'CUS-005'},
    {x:560,y:350,r:12,color:'#00E5A0',label:'CUS-006'},{x:100,y:190,r:10,color:'#FFB347',label:'CUS-007'},
    {x:780,y:210,r:10,color:'#00E5A0',label:'CUS-008'},{x:440,y:360,r:16,color:'#FF4D6D',label:'TXN-8799'},
  ];
  const edges = [[0,1],[0,2],[0,3],[0,4],[1,3],[1,7],[2,4],[2,8],[3,5],[4,6],[0,9],[9,5],[9,6]];
  edges.forEach(([a,b]) => {
    ctx.beginPath();ctx.moveTo(nodes[a].x,nodes[a].y);ctx.lineTo(nodes[b].x,nodes[b].y);
    const r = nodes[a].color==='#FF4D6D'||nodes[b].color==='#FF4D6D';
    ctx.strokeStyle=r?'rgba(255,77,109,0.4)':'rgba(99,179,237,0.2)';ctx.lineWidth=r?2:1;ctx.stroke();
  });
  nodes.forEach(n => {
    ctx.beginPath();ctx.arc(n.x,n.y,n.r,0,2*Math.PI);ctx.fillStyle=n.color+'22';ctx.fill();
    ctx.strokeStyle=n.color;ctx.lineWidth=2;ctx.stroke();
    ctx.fillStyle=n.color;ctx.font=`bold ${n.r>15?10:8}px DM Mono`;ctx.textAlign='center';
    ctx.fillText(n.label,n.x,n.y+n.r+12);
  });
}

// â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(page) {
  ['dashboard','scanner','alerts','network','str','kyc'].forEach(p => {
    document.getElementById('page-'+p).style.display = 'none';
  });
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.getElementById('page-'+page).style.display = 'block';

  const nav = document.querySelectorAll('.nav-item');
  const map = {dashboard:0,scanner:1,alerts:2,network:3,str:5,kyc:6};
  if (map[page] !== undefined) nav[map[page]]?.classList.add('active');

  if (page === 'dashboard') loadDashboard();
  if (page === 'alerts')    loadAlertsPage();
  if (page === 'str')       loadSTRPage();
  if (page === 'network')   setTimeout(drawNetwork,50);
}

// â”€â”€â”€ CHECK API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkAPI() {
  const res = await apiFetch('/api/health');
  const el  = document.getElementById('api-status-text');
  const dot = document.querySelector('.status-dot');
  if (res?.status === 'online') {
    el.textContent  = 'API Connected';
    el.style.color  = 'var(--safe)';
    dot.style.background = 'var(--safe)';
  } else {
    el.textContent  = 'API Offline';
    el.style.color  = 'var(--danger)';
    dot.style.background = 'var(--danger)';
  }
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
checkAPI();
loadDashboard();
</script>
</body>
</html>
